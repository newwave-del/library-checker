<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì†¡íŒŒë„ì„œê´€ ëŒ€ì¶œ ê°€ëŠ¥(ì „ì¼ ê¸°ì¤€)</title>
<style>
  body { font-family: system-ui, -apple-system, sans-serif; max-width: 700px; margin: 24px auto; padding: 0 12px; }
  .row { display: grid; grid-template-columns: 1fr auto auto; gap: 8px; padding: 10px 0; border-bottom: 1px solid #eee; }
  .ok { font-weight: 700; }
</style>
<h1>ì†¡íŒŒë„ì„œê´€: ëŒ€ì¶œ ê°€ëŠ¥(ì „ì¼ ê¸°ì¤€)</h1>
<div>
  <label>API KEY: <input id="key" placeholder="data4library authKey" /></label>
  <button id="go">ì¡°íšŒ</button>
</div>
<div id="list"></div>
<script>
  // ğŸ‘‰ ì—¬ê¸° ISBN í”„ë¦¬ì…‹ì— ë„¤ê°€ ë³´ê³  ì‹¶ì€ ì±…ë“¤ ë„£ì–´ë‘ë©´ ë¨
  const ISBN_PRESET = [
    "9788936434267", // ì˜¤ë§Œê³¼ í¸ê²¬ ì˜ˆì‹œ(ì¶œíŒì‚¬ë§ˆë‹¤ ISBNì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ, ì½ê³  ì‹¶ì€ íŒë³¸ì˜ ISBN13ë¡œ!)
    "9791163034353"
  ];
  // ì†¡íŒŒë„ì„œê´€ libCode
  const LIB_CODE = 4720;

  async function checkBatch(authKey, isbns) {
    // bookExistëŠ” ë³´í†µ 1ê°œì”© ì¡°íšŒ í™•ì‹¤; ê³µì§€/ë§¤ë‰´ì–¼ ìƒ JSON ì§€ì› and ì „ì¼ ìƒíƒœ ëª…ì‹œ
    // ì°¸ê³ : https://data4library.kr/noticeV?cn=93 (JSON ì§€ì›), ë§¤ë‰´ì–¼ 10ë²ˆ í•­ëª©(bookExist)
    const results = [];
    for (const isbn of isbns) {
      const url = `https://data4library.kr/api/bookExist?authKey=${encodeURIComponent(authKey)}&libCode=${LIB_CODE}&isbn13=${isbn}&format=json`;
      const res = await fetch(url);
      if (!res.ok) { results.push({ isbn, error: `HTTP ${res.status}` }); continue; }
      const data = await res.json();
      // ì‘ë‹µ ìŠ¤í‚¤ë§ˆ: result.hasBook, result.loanAvailable (Y/N)
      const r = data?.response?.result || data?.result || data;
      results.push({ isbn, hasBook: r?.hasBook, loanAvailable: r?.loanAvailable });
    }
    return results;
  }

  document.getElementById('go').onclick = async () => {
    const key = document.getElementById('key').value.trim();
    if (!key) { alert("API í‚¤ ë„£ì–´."); return; }
    const container = document.getElementById('list');
    container.innerHTML = "ì¡°íšŒ ì¤‘...";
    try {
      const rows = await checkBatch(key, ISBN_PRESET);
      container.innerHTML = "";
      rows.forEach(({ isbn, hasBook, loanAvailable, error }) => {
        const div = document.createElement('div');
        div.className = "row";
        if (error) {
          div.innerHTML = `<div>${isbn}</div><div>ì—ëŸ¬</div><div>${error}</div>`;
        } else {
          const status = (hasBook === 'Y')
            ? (loanAvailable === 'Y' ? 'ëŒ€ì¶œê°€ëŠ¥' : 'ëŒ€ì¶œì¤‘')
            : 'ë¯¸ì†Œì¥';
          div.innerHTML = `<div>${isbn}</div><div class="ok">${status}</div><div>${hasBook==='Y'?'ğŸ“š':''}</div>`;
        }
        container.appendChild(div);
      });
    } catch (e) {
      container.textContent = 'ì‹¤íŒ¨: ' + e.message;
    }
  };
</script>
